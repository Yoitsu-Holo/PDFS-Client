[toc]

# 1.简介

协议通过规定比特流中不同位置比特的含义，利用比特流进行信息的交互与传输。

# 2.客户端与服务器

## 2.1.协议头

通用的登录协议头如下：

| 变量           | 位置下标           | 含义                   |
| ---------------- | ------------------- | -------------------------- |
| op             | [0,0]             | 表示期望的操作          |
| ～             | [1+n*20,(n+1)*20] | 变长字段                |

上表中n根据op而定

每一个用户的用户名和密码长度都不能大于20，对于不足的地方用0x00在后补齐

登录成功后，服务器返回一个随机的20位码，作为以后的操作密钥(key)

通用的文件操作协议头如下：

|变量|位置下标|含义|
|-------------------------|---------------------|-----------------------------|
| op | [0,0] | 表示期望的操作 |
| key | [1,20] | 登录成功后服务器返回的操作密钥 |
| 后续操作 | [21,~] | 变长字段 |

不同的操作拥有不一样的信息传输方式，参考2.2节。

## 2.2.注意事项

1:字节流中的各属性的长度信息的数据类型为byte，字符串信息用string转化为字节流。

2:错误码返回的是字符串，需要将字节流转化为string

## 2.3 op变量

- 1:新建用户
- 2:删除用户
- 3.修改用户密码
- 4:写入文件
- 5:读取文件
- 6:删除文件
- 7:创建路径
- 8:删除路径
- 255:请求该目录下文件

### 2.2.3.新建用户

新建用户时，用户需要提供长度不超过20的字符串作为用户名和密码。

| 变量         | 位置下标   | 含义   |
| ------------ | ------------ | ---------- |
| username | [1,20] | 用户名字符串 |
| passwd       | [21,40]| 密码字符串  |

### 2.2.2.删除用户

注销只能在登录后才能注销

注销时，用户需要再次输入密码进行身份确认。

| 变量         | 位置下标         | 含义       |
| ------------ | ------------------ | ----------------- |
| key | [1,20] | 操作密钥 |
| passwd | [21，40] | 密码字符串  |

### 2.2.3.修改用户密码

修改密码时，用户需要提供原来的密码和新的密码

| 变量            | 位置下标            | 含义         |
| --------------- | ------------------ | ------------ |
| key          | [1,20] |  操作密钥     |
| newpasswd    | [21,40] | 新密码字符串          |

### 2.2.4.登陆

登陆时，用户需要输入密码进行身份确认。

| 变量         | 位置下标       | 含义      |
| ------------ | --------------- | --- |
| username | [1,20] | 用户名字符串 |
| passwd       | [21,40] | 密码字符串        |

### 2.2.5,2.2.6,2.2.7上传文件,下载文件，删除文件

| 变量    | 位置下标    | 含义  |
| ---------- | -------- | --------- |
| key            | [1,20] | 操作密钥 |
| pathLength     | [21,22] | 路径长度，不超过short |
| path           | [22+1,22+pathLength] | 路径。|
| filenameLength | [22+pathLength+1,22+pathLength+1]   | 文件名长度，不超过char  |
| filename       | [22+pathLengh+2,22+pathLength+2+filenameLength] | 文件名 |

注意:

对于path

pdfs的文件存储在pdfs项目下的namespace文件夹，namespace文件夹下的各个文件夹是每个用户的个人存储空间。

如一个用户的用户名为user，其存储了一个文件file在其个人存储空间的根目录中，则有路径../pdfs-handler/namespace/user/file

**注意，如上所示的例子，若用户想要存储$file到其存储空间的根目录下，则应该提供的是相对用户空间的路径（不包括文件名）。即"/"** 


### 2.2.7,2.2.8.创建文件夹,删除文件夹

| 变量          | 位置下标     | 含义       |
| ------------- | --------- | ------------- |
| key           | [1,20] | 操作密钥 |
| pathLength    | [21,22]     | 路径长度，不超过short   |
| path          | [22+1,22+pathLength]               | 路径    |
| dirnameLength | [22+pathLength+1,22+pathLength+1]    | 文件夹名称长度，不超过char     |
| dirname       | [22+pathLengh+2,22+pathLength+2+filenameLength] | 文件夹名称|

注意:

对于path

pdfs的文件存储在pdfs项目下的namespace文件夹，namespace文件夹下的各个文件夹是每个用户的个人存储空间

如一个用户的用户名为user，其存储了一个文件夹dir在其个人存储空间的根目录中，则有路径../pdfs-handler/namespace/user/dir

**注意，如上所示的例子，若用户想要存储$file到其存储空间的根目录下，则应该提供的是相对用户空间的路径（不包括文件夹名）。即"/"** 

### 2.2.255.请求该目录下文件

| 变量       | 位置下标                                   | 含义           |
| ---------- | ------------------------------------------ | -------------- |
| key | [1,20] | 操作密钥 |
| pathLength | [21,22]      | 路径长度，不超过short |
| path       | [22+1,22+pathLength] | 路径   |

## 2.3.错误码

| 返回值 | 含义                   |
| ------ | ---------------------- |
| 0      | 操作成功               |
| 1      | 操作失败，未知错误     |
| 2      | 操作失败，文件不存在   |
| 3      | 操作失败，路径不存在   |
| 4      | 操作失败，密码错误     |
| 5      | 操作失败，该用户已存在 |
| 6      | 操作失败，该用户不存在 |
| 7      | 操作失败，参数错误     |
| 8      | 操作失败，操作不存在   |

# 3.服务器和后端

## 3.1.请求协议

| 变量     | 位置下标 | 含义                                                         |
| -------- | -------- | ------------------------------------------------------------ |
| op       | [0,0]    | 操作类型<br />1代表写操作<br />2代表读操作<br />3代表删除操作 |
| fileName | [1,EOF]  | 文件名                                                       |

## 3.2.返回值

| 返回值 | 含义                 |
| ------ | -------------------- |
| 0      | 表示成功             |
| 1      | 操作失败，未知错误   |
| 2      | 操作失败，文件不存在 |
| 3      | 操作失败，操作不存在 |
